name: Run Paranoia on Paranoia

on: workflow_dispatch
env:
  GITHUB_CONTEXT: ${{ toJSON(github) }}
jobs:
    paranoia-inception:
      runs-on: ubuntu-latest
      steps:
        - run: echo "$GITHUB_CONTEXT"

        - name: "Checkout code"
          uses: actions/checkout@v3

        - name: "Build container"
          id: "build-and-save"
          run: |
            docker build Containerfile
            docker save > tmp.tar
            BUILT_CONTAINER=$(cat tmp.tar) 

            echo "::set-output name=container_tar_content::${container_tar_content}"

        - name: "Run Paranoia container"
          uses: ./.github/actions/paranoia
          with:
            action: inspect
            target: " - ${{steps.build-and-save.outputs.container_tar_content}}"
