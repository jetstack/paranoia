name: Run Paranoia on Paranoia

on: workflow_dispatch
env:
  GITHUB_CONTEXT: ${{ toJSON(github) }}
jobs:
    paranoia-inception:
      runs-on: ubuntu-latest
      steps:
        - name: "Checkout code"
          uses: actions/checkout@v3

        - name: "Build container"
          id: "build-and-save"
          run: |
            docker build -t paranoia .
            docker save paranoia > tmp.tar
            BUILT_CONTAINER_TAR=$(cat tmp.tar) 

            echo "::set-output name=container_tar_content::file://${BUILT_CONTAINER_TAR}"

        - name: "Run Paranoia container"
          uses: ./
          with:
            action: inspect
            target_tar: ${{steps.build-and-save.outputs.container_tar_content}}
